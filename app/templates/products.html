<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>{{ p.brand }} ‚Äî Products & Categories</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{ --bg1:#0b0f1a; --bg2:#141a2a; --accent:#77e6ff; --accent2:#9d7bff; --blur:18px; --radius:18px; }
  body{
    background:
      radial-gradient(1200px 600px at 10% -10%, #1b2440 0%, transparent 60%),
      radial-gradient(1000px 500px at 110% 10%, #212b54 0%, transparent 65%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#eaf2ff; font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
  }
  .glass{
    background: rgba(255,255,255,.08);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border:1px solid rgba(255,255,255,.14);
    border-radius: var(--radius);
    box-shadow: 0 12px 32px rgba(0,0,0,.42), inset 0 1px 0 rgba(255,255,255,.08);
    position:relative;
  }
  .glass:after{
    content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
    background: linear-gradient(135deg, rgba(119,230,255,.24), rgba(157,123,255,.2));
    filter: blur(20px); opacity:.35; z-index:-1;
  }
  .chip{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#0b1120; font-weight:800; font-size:12px; padding:6px 12px; border-radius:999px; box-shadow:0 0 24px rgba(119,230,255,.35) }
  .btn-glass{ background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.14); border-radius:14px; padding:10px 12px; font-weight:700; text-align:center; transition:.2s }
  .btn-glass:hover{ transform:translateY(-1px); box-shadow:0 0 20px rgba(119,230,255,.35) }
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55) }
  .modal[open]{ display:flex }
</style>
</head>
<body class="antialiased selection:bg-cyan-300/20 selection:text-white">

<div class="mx-auto max-w-6xl px-3 sm:px-5 py-5">

  <!-- Top Bar -->
  <header class="glass p-4 flex items-center gap-3">
    <a href="{{ url_for('main.profile') }}" class="btn-glass">‚Üê Back</a>
    <div class="chip">All Categories</div>
    <div class="ml-auto flex gap-2">
      {% if admin %}
        <button class="btn-glass" onclick="openAdd()">‚ûï Add Product</button>
        <a href="{{ url_for('main.logout') }}" class="btn-glass">Logout</a>
      {% else %}
        <button class="btn-glass" onclick="openPin()">üîë Admin</button>
      {% endif %}
    </div>
  </header>

  <!-- Category pills -->
  <section class="glass p-4 mt-4">
    <div class="text-sm text-slate-300/85">Filter by Category</div>
    <div class="flex gap-2 flex-wrap mt-2">
      <a class="btn-glass {% if not selected %}!bg-white/15 {% endif %}" href="{{ url_for('main.products') }}">All</a>
      {% for c in categories %}
        <a class="btn-glass {% if selected == c %}!bg-white/15 {% endif %}" href="{{ url_for('main.products', category=c) }}">{{ c }}</a>
      {% endfor %}
    </div>
  </section>

  <!-- If editing -->
  {% if admin and edit_item %}
  <section class="glass p-4 mt-4">
    <div class="chip">Edit Product</div>
    <form method="post" action="{{ url_for('main.edit_product_route', pid=edit_item.id) }}" class="grid md:grid-cols-2 gap-3 mt-3">
      <div class="md:col-span-2 grid sm:grid-cols-2 gap-2">
        <select name="category" class="px-3 py-2 rounded text-black">
          {% for c in categories %}<option value="{{ c }}" {% if edit_item.category==c %}selected{% endif %}>{{ c }}</option>{% endfor %}
        </select>
        <input name="title" value="{{ edit_item.title }}" required class="px-3 py-2 rounded text-black" placeholder="Title">
      </div>
      <input name="photo" value="{{ edit_item.photo }}" class="px-3 py-2 rounded text-black" placeholder="Image URL">
      <textarea name="desc" class="px-3 py-2 rounded text-black h-28" placeholder="Description">{{ edit_item.desc }}</textarea>
      <div class="md:col-span-2 flex gap-2">
        <button class="btn-glass grow">Save Changes</button>
        <a class="btn-glass grow" href="{{ url_for('main.products') }}">Cancel</a>
      </div>
    </form>
  </section>
  {% endif %}

  <!-- Product Grid -->
  <section class="glass p-4 mt-4">
    <div class="flex items-center justify-between">
      <div class="chip">Products{% if selected %} ‚Äî {{ selected }}{% endif %}</div>
      <div class="text-xs text-slate-300/85">Click WhatsApp to inquire</div>
    </div>

    {% if products %}
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-3 mt-3">
      {% for pdt in products %}
      <article class="glass overflow-hidden">
        <div class="w-full" style="aspect-ratio:16/10; background:rgba(255,255,255,.05)">
          {% if pdt.photo %}
            <img src="{{ pdt.photo }}" alt="" class="w-full h-full object-cover">
          {% endif %}
        </div>
        <div class="p-3">
          <div class="font-bold">{{ pdt.title }}</div>
          <div class="text-xs text-slate-300/85 mt-1">{{ pdt.desc }}</div>
          <div class="text-[11px] text-cyan-300 mt-1">Category: {{ pdt.category }}</div>

          <div class="grid grid-cols-2 gap-2 mt-2">
            <a class="btn-glass text-center"
               href="https://wa.me/918653568180?text={{ ('I want to know about: ' ~ pdt.title)|urlencode }}">WhatsApp</a>

            {% if admin %}
            <a class="btn-glass text-center" href="{{ url_for('main.products', edit=pdt.id, category=selected) }}">Edit</a>
            {% else %}
            <a class="btn-glass text-center" href="{{ url_for('main.profile') }}">Profile</a>
            {% endif %}
          </div>

          {% if admin %}
          <form method="post" action="{{ url_for('main.delete_product_route', pid=pdt.id) }}" class="mt-2">
            <button class="btn-glass w-full bg-red-600/30 border-red-500/40">Delete</button>
          </form>
          {% endif %}
        </div>
      </article>
      {% endfor %}
    </div>
    {% else %}
      <div class="mt-3 text-sm text-slate-300/85">No products in this view.</div>
    {% endif %}
  </section>
</div>

<!-- PIN Modal -->
<dialog id="pinModal" class="modal">
  <form method="post" action="{{ url_for('main.login') }}" class="glass p-5 w-[92%] max-w-sm">
    <div class="flex items-center justify-between">
      <div class="chip">Admin Login</div>
      <button type="button" class="text-slate-300" onclick="closePin()">‚úï</button>
    </div>
    <p class="text-sm text-slate-300/85 mt-2">Enter PIN to manage products.</p>
    <input type="password" name="pin" class="mt-3 w-full px-3 py-2 rounded text-black" placeholder="Enter PIN" required>
    <button class="btn-glass mt-3 w-full">Login</button>
  </form>
</dialog>

<!-- Add Modal -->
<dialog id="addModal" class="modal">
  <form method="post" action="{{ url_for('main.add_product_route') }}" class="glass p-5 w-[92%] max-w-lg">
    <div class="flex items-center justify-between">
      <div class="chip">Add Product</div>
      <button type="button" class="text-slate-300" onclick="closeAdd()">‚úï</button>
    </div>
    <div class="grid gap-2 mt-3">
      <select name="category" class="px-3 py-2 rounded text-black">
        {% for c in categories %}<option value="{{ c }}" {% if selected==c %}selected{% endif %}>{{ c }}</option>{% endfor %}
      </select>
      <input name="title" required placeholder="Product Title" class="px-3 py-2 rounded text-black">
      <input name="photo" type="url" placeholder="Image URL (optional)" class="px-3 py-2 rounded text-black">
      <textarea name="desc" placeholder="Short Description (optional)" class="px-3 py-2 rounded text-black h-28"></textarea>
    </div>
    <button class="btn-glass mt-3 w-full">Save</button>
  </form>
</dialog>

<script>
  // Modals
  const pinModal = document.getElementById("pinModal");
  const addModal = document.getElementById("addModal");
  function openPin(){ pinModal.setAttribute("open",""); }
  function closePin(){ pinModal.removeAttribute("open"); }
  function openAdd(){ addModal.setAttribute("open",""); }
  function closeAdd(){ addModal.removeAttribute("open"); }
  window.openPin=openPin; window.closePin=closePin; window.openAdd=openAdd; window.closeAdd=closeAdd;
</script>
</body>
</html>
