<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>{{ p.brand }} â€” Digital Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#0b0f1a">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{
    --bg1:#0b0f1a; --bg2:#141a2a;
    --accent:#77e6ff; --accent2:#9d7bff;
    --blur:18px; --radius:18px;
  }
  body{
    background:
      radial-gradient(1200px 600px at 10% -10%, #1b2440 0%, transparent 60%),
      radial-gradient(1000px 500px at 110% 10%, #212b54 0%, transparent 65%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#eaf2ff;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
  }
  .glass{
    background: rgba(255,255,255,.08);
    backdrop-filter: blur(var(--blur));
    -webkit-backdrop-filter: blur(var(--blur));
    border:1px solid rgba(255,255,255,.14);
    border-radius: var(--radius);
    box-shadow: 0 12px 32px rgba(0,0,0,.42), inset 0 1px 0 rgba(255,255,255,.08);
    position:relative;
  }
  .glass:after{
    content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
    background: linear-gradient(135deg, rgba(119,230,255,.24), rgba(157,123,255,.2));
    filter: blur(20px); opacity:.35; z-index:-1;
  }
  .chip{ background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#0b1120; font-weight:700; font-size:12px; padding:6px 12px; border-radius:999px; box-shadow:0 0 24px rgba(119,230,255,.35) }
  .btn-glass{ background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.14); border-radius:14px; padding:12px; text-align:center; font-weight:700; transition:.2s }
  .btn-glass:hover{ transform:translateY(-1px); box-shadow:0 0 20px rgba(119,230,255,.35) }
  .ring-accent{ box-shadow:0 0 0 2px rgba(119,230,255,.45) }
  .shadow-neon{ box-shadow:0 8px 24px rgba(119,230,255,.18) }
  .link{ text-decoration:none }
  .admin-pill{ position:fixed; bottom:16px; right:16px; z-index:50 }
  .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55) }
  .modal[open]{ display:flex }
</style>
</head>
<body class="antialiased selection:bg-cyan-300/20 selection:text-white">

<div class="mx-auto max-w-lg md:max-w-3xl lg:max-w-5xl px-3 sm:px-4 md:px-6 py-5">

  <!-- Header -->
  <header class="glass p-5">
    <div class="flex items-center gap-3">
      {% if p.logo %}
        <img src="{{ p.logo }}" alt="logo" class="w-12 h-12 rounded-xl object-cover border border-white/20 shadow-neon">
      {% else %}
        <div class="w-12 h-12 rounded-xl chip grid place-items-center">GX</div>
      {% endif %}
      <div class="min-w-0">
        <h1 class="text-xl sm:text-2xl font-extrabold truncate">{{ p.brand }}</h1>
        <p class="text-slate-300/85 text-xs sm:text-sm">{{ p.tagline }}</p>
      </div>
      <a href="tel:{{ p.phone_raw }}" class="ml-auto hidden sm:inline-flex chip rounded-full">ðŸ“ž {{ p.phone_display }}</a>
    </div>

    <div class="grid place-items-center mt-4">
      {% if p.avatar %}
        <img src="{{ p.avatar }}" class="w-28 h-28 sm:w-32 sm:h-32 rounded-full object-cover border border-white/25 ring-accent shadow-neon" alt="avatar">
      {% else %}
        <div class="w-28 h-28 sm:w-32 sm:h-32 rounded-full grid place-items-center border border-white/25 ring-accent shadow-neon text-3xl font-bold bg-white/5">ðŸ‘¤</div>
      {% endif %}
    </div>

    <!-- Quick actions -->
    <div class="mt-4 grid grid-cols-2 gap-2 sm:grid-cols-4">
      <a class="btn-glass" href="tel:{{ p.phone_raw }}">Call</a>
      <a class="btn-glass" href="https://wa.me/{{ p.phone_raw|replace('+','') }}?text=Hi%20{{ p.brand|replace(' ','%20') }}">WhatsApp</a>
      <a class="btn-glass" href="mailto:{{ p.email }}">Email</a>
      <a class="btn-glass" href="{{ p.maps_link }}">Maps</a>
    </div>
  </header>

  <!-- Social / Group / Add to contacts -->
  <section class="mt-4 grid gap-4 sm:grid-cols-2">
    <div class="glass p-4">
      <div class="chip inline-block">Social</div>
      <div class="mt-3 grid grid-cols-2 gap-2">
        <a class="btn-glass" href="{{ p.instagram }}">Instagram</a>
        <a class="btn-glass" href="{{ p.facebook }}">Facebook</a>
        <a class="btn-glass" href="{{ p.youtube }}">YouTube</a>
        <a class="btn-glass" href="{{ p.map_review }}">Map Review</a>
      </div>
      <a class="btn-glass mt-3 block" href="{{ p.wa_group }}">WhatsApp Group</a>
    </div>

    <div class="glass p-4">
      <div class="chip inline-block">Contact Card</div>
      <p class="mt-2 text-sm text-slate-300/85">Save our contact or share this profile.</p>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
        <a class="btn-glass" href="{{ url_for('main.profile') }}vcard.vcf" onclick="event.preventDefault(); downloadVCF();">Add to Contacts</a>
        <button class="btn-glass" id="shareBtn">Share Profile</button>
      </div>
      <div class="mt-2 text-xs text-slate-400">Saved name: <b>{{ p.brand }}</b> â€¢ {{ p.phone_display }}</div>
    </div>
  </section>

  <!-- Products -->
  <section class="mt-4 glass p-4">
    <div class="flex items-center justify-between flex-wrap gap-2">
      <div class="chip">View Recent Products</div>
      <div class="flex items-center gap-2">
        <a class="btn-glass" href="{{ url_for('main.products') }}">View All Categories</a>

        {% if admin %}
          <button class="btn-glass" onclick="openAddModal()">âž• Add Product</button>
        {% else %}
          <button class="btn-glass" onclick="openPin()">ðŸ”‘ Admin</button>
        {% endif %}
      </div>
    </div>

    {% if products %}
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 mt-3">
        {% for pdt in products %}
        <article class="glass overflow-hidden">
          <div class="w-full" style="aspect-ratio:16/10; background:rgba(255,255,255,.05)">
            {% if pdt.photo %}
              <img src="{{ pdt.photo }}" alt="" class="w-full h-full object-cover">
            {% endif %}
          </div>
          <div class="p-3">
            <div class="font-bold text-base">{{ pdt.title }}</div>
            <div class="text-xs text-slate-300/85 mt-1">{{ pdt.desc }}</div>
            <div class="text-[11px] text-cyan-300 mt-1">Category: {{ pdt.category }}</div>
            <a class="btn-glass mt-2 inline-block"
               href="https://wa.me/918653568180?text={{ ('I am interested in: ' ~ pdt.title)|urlencode }}">WhatsApp</a>

            {% if admin %}
            <div class="flex gap-2 mt-2">
              <a class="btn-glass flex-1 text-center" href="{{ url_for('main.products', edit=pdt.id) }}">Edit</a>
              <form method="post" action="{{ url_for('main.delete_product_route', pid=pdt.id) }}" class="flex-1">
                <button class="w-full btn-glass bg-red-600/30 border-red-500/40">Delete</button>
              </form>
            </div>
            {% endif %}
          </div>
        </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="mt-3 text-sm text-slate-300/85">No products yet.</div>
    {% endif %}
  </section>

</div>

<!-- Admin floating button -->
{% if not admin %}
<button class="admin-pill chip" onclick="openPin()">Admin</button>
{% else %}
<a class="admin-pill chip" href="{{ url_for('main.logout') }}">Logout</a>
{% endif %}

<!-- PIN Modal -->
<dialog id="pinModal" class="modal">
  <form method="post" action="{{ url_for('main.login') }}" class="glass p-5 w-[92%] max-w-sm">
    <div class="flex items-center justify-between">
      <div class="chip">Admin Login</div>
      <button type="button" class="text-slate-300" onclick="closePin()">âœ•</button>
    </div>
    <p class="text-sm text-slate-300/85 mt-2">Enter PIN to manage products.</p>
    <input type="password" name="pin" class="mt-3 w-full px-3 py-2 rounded text-black" placeholder="Enter PIN" required>
    <button class="btn-glass mt-3 w-full">Login</button>
  </form>
</dialog>

<!-- Add Modal -->
<dialog id="addModal" class="modal">
  <form method="post" action="{{ url_for('main.add_product_route') }}" class="glass p-5 w-[92%] max-w-lg">
    <div class="flex items-center justify-between">
      <div class="chip">Add Product</div>
      <button type="button" class="text-slate-300" onclick="closeAdd()">âœ•</button>
    </div>
    <div class="grid gap-2 mt-3">
      <select name="category" class="px-3 py-2 rounded text-black">
        {% for c in categories %}<option value="{{ c }}">{{ c }}</option>{% endfor %}
      </select>
      <input name="title" required placeholder="Product Title" class="px-3 py-2 rounded text-black">
      <input name="photo" type="url" placeholder="Image URL (optional)" class="px-3 py-2 rounded text-black">
      <textarea name="desc" placeholder="Short Description (optional)" class="px-3 py-2 rounded text-black h-28"></textarea>
    </div>
    <button class="btn-glass mt-3 w-full">Save</button>
  </form>
</dialog>

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="fixed bottom-3 right-3 space-y-2 z-50">
      {% for category, msg in messages %}
        <div class="px-4 py-2 rounded text-white
          {% if category == 'success' %} bg-green-600
          {% elif category == 'error' %} bg-red-600
          {% else %} bg-blue-600 {% endif %}">
          {{ msg }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}





<!-- Fixed Bottom Nav (Glass / Neo) -->
<nav class="fixed bottom-3 inset-x-3 z-50">
  <div class="flex items-center justify-between gap-2 rounded-2xl
              bg-white/10 backdrop-blur-md border border-white/15
              px-3 py-2 shadow-[0_10px_30px_rgba(0,0,0,.35)]">

    <!-- Call -->
    <a href="tel:+918653568180"
       class="flex flex-col items-center justify-center gap-1 flex-1
              rounded-xl px-3 py-2 hover:bg-white/10 transition">
      <!-- phone icon -->
      <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.6">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M2.5 5.5c0-1.1.9-2 2-2h2c.8 0 1.5.5 1.8 1.2l1 2.4c.3.7.1 1.5-.4 2l-1.1 1.1a15 15 0 0 0 7 7l1.1-1.1c.5-.5 1.3-.7 2-.4l2.4 1c.7.3 1.2 1 1.2 1.8v2c0 1.1-.9 2-2 2h-1A18.5 18.5 0 0 1 3.5 6.5v-1Z"/>
      </svg>
      <span class="text-[11px] font-semibold">Call</span>
    </a>

    <!-- WhatsApp -->
    <a href="https://wa.me/918653568180?text=Hi%20GameX%20PC%20Hub"
       class="flex flex-col items-center justify-center gap-1 flex-1
              rounded-xl px-3 py-2 hover:bg-white/10 transition">
      <!-- whatsapp icon -->
      <svg viewBox="0 0 24 24" class="w-5 h-5" fill="currentColor">
        <path d="M20.52 3.48A10.06 10.06 0 0 0 12 0C5.37 0 .02 5.35.02 12c0 2.11.55 4.14 1.6 5.95L0 24l6.2-1.62A11.9 11.9 0 0 0 12 24C18.63 24 24 18.65 24 12a10.06 10.06 0 0 0-3.48-8.52ZM12 22a9.9 9.9 0 0 1-5.05-1.4l-.36-.21-3.67.96.98-3.57-.23-.37A9.95 9.95 0 1 1 22 12 9.98 9.98 0 0 1 12 22Zm5.22-7.32c-.29-.15-1.69-.83-1.95-.93-.26-.1-.45-.15-.64.15-.19.29-.74.93-.91 1.12-.17.19-.34.22-.63.08-.29-.15-1.23-.45-2.34-1.44-.86-.76-1.43-1.7-1.6-1.99-.17-.29-.02-.45.13-.6.13-.13.29-.34.43-.51.15-.17.19-.29.29-.48.1-.19.05-.36-.03-.51-.08-.15-.64-1.54-.88-2.1-.23-.54-.47-.47-.64-.48h-.55c-.19 0-.51.08-.77.37-.26.29-1.01.99-1.01 2.42 0 1.43 1.03 2.81 1.17 3 .15.19 2.03 3.1 4.9 4.34.69.3 1.22.48 1.64.61.69.22 1.31.19 1.8.12.55-.08 1.69-.69 1.93-1.36.24-.67.24-1.25.17-1.36-.07-.11-.26-.19-.55-.34Z"/>
      </svg>
      <span class="text-[11px] font-semibold">WhatsApp</span>
    </a>

    <!-- Email -->
    <a href="mailto:saidmessi4321@gmail.com"
       class="flex flex-col items-center justify-center gap-1 flex-1
              rounded-xl px-3 py-2 hover:bg-white/10 transition">
      <!-- mail icon -->
      <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.6">
        <rect x="3" y="5" width="18" height="14" rx="2" ry="2"/>
        <path d="M3 7l9 7 9-7"/>
      </svg>
      <span class="text-[11px] font-semibold">Email</span>
    </a>

    <!-- Map -->
    <a href="https://maps.app.goo.gl/UdeBHbvDXAYmRU2D7"
       class="flex flex-col items-center justify-center gap-1 flex-1
              rounded-xl px-3 py-2 hover:bg-white/10 transition">
      <!-- map-pin icon -->
      <svg viewBox="0 0 24 24" class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="1.6">
        <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 22s7-5.4 7-11a7 7 0 1 0-14 0c0 5.6 7 11 7 11Z"/>
        <circle cx="12" cy="11" r="3"/>
      </svg>
      <span class="text-[11px] font-semibold">Map</span>
    </a>

  </div>
</nav>

<!-- spacer so nav doesn't cover content on mobile -->
<div class="h-20"></div>


<script>
  // Share profile (mobile-friendly)
  document.getElementById("shareBtn")?.addEventListener("click", async () => {
    const url = location.href;
    const data = {title: "{{ p.brand }}", text: "Check our profile & products", url};
    if (navigator.share) { try { await navigator.share(data); } catch(e){} }
    else { try { await navigator.clipboard.writeText(url); alert("Link copied!"); } catch(e){ alert(url); } }
  });

  // vCard builder
  function downloadVCF(){
    const v = [
      "BEGIN:VCARD","VERSION:3.0",
      "N:Hub;GameX;;;",
      "FN:{{ p.brand }}",
      "ORG:{{ p.brand }}",
      "TITLE:{{ p.owner_title }}",
      "TEL;TYPE=CELL,VOICE:{{ p.phone_raw }}",
      "EMAIL:{{ p.email }}",
      "URL:"+location.origin,
      "ADR;TYPE=WORK:;;{{ p.address }};;;;",
      "END:VCARD"
    ].join("\\n");
    const blob = new Blob([v], {type:"text/vcard"});
    const a = Object.assign(document.createElement("a"), {href:URL.createObjectURL(blob), download:"GameX-PC-Hub.vcf"});
    document.body.appendChild(a); a.click(); setTimeout(()=>URL.revokeObjectURL(a.href), 500); a.remove();
  }

  // Modals
  const pinModal = document.getElementById("pinModal");
  const addModal = document.getElementById("addModal");
  function openPin(){ pinModal.setAttribute("open",""); }
  function closePin(){ pinModal.removeAttribute("open"); }
  function openAdd(){ addModal.setAttribute("open",""); }
  function closeAdd(){ addModal.removeAttribute("open"); }
  window.openPin = openPin; window.openAdd = openAdd; window.closeAdd = closeAdd; window.closePin = closePin;
</script>
</body>
</html>
